{% extends "layout.html" %}

{% block content %}

<script>
    header_bar = document.getElementById('header_bar').style.display = 'none';

    var stop_user = 1;

    window.addEventListener('beforeunload', function (e) {
        if (stop_user == 1) {
          // Cancel the event
          e.preventDefault();
          // Chrome requires returnValue to be set
          e.returnValue = '';
      }
    });


  function safe_exit() {
    console.log("allowed to leave");
    stop_user = 0;
    document.getElementById('safe_exit_form').submit();
  }

  function submit_pair() {
    stop_user = 0;
    document.getElementById('submit_answer_form').submit();
  }

</script>


<div class="row">
    <div class="col-lg-6">
        <form id="safe_exit_form" method="POST" action="/safeexit">
            <div class="row">
                <div class="col-md-12 text-left">
                    <button class="btn btn-danger btn-lg" onclick="safe_exit()">Exit Without Submitting</button>
                </div>
                <input type="hidden" name="file_one_name"
                           value="{{ file_one_name }}">
                <input type="hidden" name="file_two_name"
                           value="{{ file_two_name }}">
            </div>
        </form>
    </div>
    <div class="col-lg-6">
        <form id="hard_easy_form" method="POST" action="/hardeasy">
            <div class="row">
                <div class="col-md-12 text-right">
                    <button class="btn btn-warning btn-lg" onclick="safe_exit()">Too Hard / Too Easy</button>
                </div>
                <input type="hidden" name="file_one_name"
                           value="{{ file_one_name }}">
                <input type="hidden" name="file_two_name"
                           value="{{ file_two_name }}">
            </div>
        </form>
    </div>
</div>
<form id="submit_answer_form" method="POST" action="/submitAnswer">
    <div class="row">
        <div class="col-md-12 text-center">
            <h3>Select the easier text</h3>
            <input type="hidden" name="preferred" id="preferred_hidden" value="">
            <input type="hidden" name="time_started" value="{{ time_started }}">
        </div>
    </div>
    <div class="row">
        <div class="col-md-6 text_window" onclick="a_preferred()">
            <div class="card border-secondary mb-3" id="doc_a_div">
                <div class="card-header text-center sorter_header" id="doc_a_header">
                    <div class="hidden_div">Holding</div>
                </div>
                <textarea readonly class="card-body card-height text_window"
                          style="resize: none">{{ file_one }}</textarea>
            </div>
        </div>
        <div class="col-md-6 text_window" onclick="b_preferred()">
            <div class="card border-secondary mb-3" id="doc_b_div">
                <div class="card-header text-center sorter_header" id="doc_b_header">
                    <div class="hidden_div">Holding</div>
                </div>
                <textarea readonly class="card-body card-height text_window"
                          style="resize: none">{{ file_two }}</textarea>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12 text-center">
            <h3>Indicate each text's difficulty</h3>
        </div>
    </div>
    <!--
    <div class="row" style="margin-bottom: 10pt;">
        <div class="col-md-6 text-center">
            <div class="btn-group btn-group-toggle" data-toggle="buttons">
                <label class="btn btn-success btn-lg level_button">
                    <input type="radio" name="level_a" id="easy_a"
                           autocomplete="off">Really Easy</label>
                <label class="btn btn-secondary btn-lg level_button">
                    <input type="radio" name="level_a" id="neutral_a"
                           autocomplete="off">At My Level</label>
                <label class="btn btn-danger btn-lg">
                    <input type="radio" name="level_a" id="hard_a"
                           autocomplete="off">Really Hard</label>
            </div>
        </div>
        <div class="col-md-6 text-center">
            <div class="btn-group btn-group-toggle" data-toggle="buttons">
                <label class="btn btn-success btn-lg level_button">
                    <input type="radio" name="level_b" id="easy_b"
                           autocomplete="off">Really Easy</label>
                <label class="btn btn-secondary btn-lg level_button">
                    <input type="radio" name="level_b" id="neutral_b"
                           autocomplete="off">At My Level</label>
                <label class="btn btn-danger btn-lg">
                    <input type="radio" name="level_b" id="hard_b"
                           autocomplete="off">Really Hard</label>
            </div>
        </div>
    </div>
    -->
    <div class="row">
        <div class="col-md-12 text-center">
            <button id="pair_submit_button" class="btn btn-primary btn-lg" onclick="submit_pair()" disabled>Submit
                Answer
            </button>
            <br>
            <input type="hidden" name="file_one_name"
                   value="{{ file_one_name }}">
            <input type="hidden" name="file_two_name"
                   value="{{ file_two_name }}">
        </div>
    </div>
    <div class="row">
        <div class="col-md-12 text-center">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="another_pair" name="another_pair_checkbox" checked>
                <label class="form-check-label" for="another_pair">
                Give me another pair
                </label>
            </div>
        </div>
    </div>
</form>

<script>


  function a_preferred() {
    document.getElementById("preferred_hidden").value = "{{ file_one_name }}"
    document.getElementById("doc_a_header").innerHTML = "EASIER"
    document.getElementById("doc_b_header").innerHTML = "HARDER"
    document.getElementById("doc_b_div").className = "card border-danger mb-3"
    document.getElementById("doc_b_header").className = "card-header bg-danger text-center"
    document.getElementById("doc_a_div").className = "card border-success mb-3"
    document.getElementById("doc_a_header").className = "card-header bg-success text-center"
    document.getElementById("pair_submit_button").disabled = false;
  }

  function b_preferred() {
    document.getElementById("preferred_hidden").value = "{{ file_two_name }}"
    document.getElementById("doc_b_header").innerHTML = "EASIER"
    document.getElementById("doc_a_header").innerHTML = "HARDER"
    document.getElementById("doc_a_div").className = "card border-danger mb-3"
    document.getElementById("doc_a_header").className = "card-header bg-danger text-center sorter_header"
    document.getElementById("doc_b_div").className = "card border-success mb-3"
    document.getElementById("doc_b_header").className = "card-header bg-success text-center sorter_header"
    document.getElementById("pair_submit_button").disabled = false;
  }


</script>

<div id="timeout_modal" class="modal">
  <div class="modal-content text-center">
      <div class="row">
          <div class="col-md-12 text-center">
          <h3>Timeout</h3>
          <p>Your time to submit this pair has expired.</p>
          <a href="/sorter"><button class="btn btn-primary btn-lg">New Pair</button></a>
          <a href="/home"><button class="btn btn-success btn-lg">Home</button></a>
          </div>
      </div>
  </div>
</div>

<script>

    var modal = document.getElementById('timeout_modal')

    function show_timeout_modal() {
              modal.style.display = "block";
            }

    setTimeout(() => {
    stop_user = 0;
    show_timeout_modal(); }, {{ timeout }});

</script>
{% endblock content %}
